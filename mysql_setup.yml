- name: Install Database Server (MySQL)
  hosts: db-server-01
  become: yes

  tasks:

    - name: Install MySQL Server
      apt:
        name: mysql-server
        state: present
        update_cache: yes

    - name: Start and enable MySQL service
      systemd:
        name: mysql
        state: started
        enabled: yes

    - name: Create database
      shell: |
        mysql -e "CREATE DATABASE IF NOT EXISTS {{ db_name }};"

    - name: Create database user
      shell: |
        mysql -e "CREATE USER IF NOT EXISTS '{{ db_user }}'@'%' IDENTIFIED BY '{{ db_password }}';"

    - name: Grant privileges
      shell: |
        mysql -e "GRANT ALL PRIVILEGES ON {{ db_name }}.* TO '{{ db_user }}'@'%'; FLUSH PRIVILEGES;"
